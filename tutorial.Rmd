---
title: "Final Project"
author: "Katherine Zen, Zhiyue Gao, Weiyi Qin"
---

# Analysis of crime record of San Fransico


### Motivation:

Monitoring and tracking cirme records of cities seems fairly important, it not only implicitly states how crimes are committed but also gives the authorities a better way to analyze the features of crimes across cities and enforce more security to reduce the crimes efficiently. Therefore, we are giving this turorial of how to do the analysis of a San Fransico Crime Data Set in a way of data science that we learned in class of CMSC320.

### Introduction

In this project, we basing on the [dataset](https://www.kaggle.com/roshansharma/sanfranciso-crime-dataset/data#) on the Kaggle provided by Roshan Sharma to give a tutorial how to do the anaylsis. Generally we are splitting this tutorial into **3** parts:

* Evaluating data basing on single attributes

* Comparison and analysis of two and more attributes

* Regression of crime dataset



### Data Preparation: 

Firstly, we get data from Roshan Sharma's [Kaggle page](https://www.kaggle.com/roshansharma/sanfranciso-crime-dataset/data#), then we get our dataset by read.csv

```{r data prep}

library(rvest)
library(tidyverse)
library(tidyr)
library(lubridate)
library(dplyr) 
library(leaflet)

data <- read.csv("Police_Department_Incidents_-_Previous_Year__2016_.csv")
head(data,10)

```

There are 12 attributes, their data types and attributes' descriptions from the Kaggle websites.

| Num | Name | Type | Description |
|-----|------|------|-------------|
| 1 | `IncidntNum` | categorical | Incident Number |
| 2 | `Category` | categorical unordered | Description of Crime  |
| 3 | `DayOfWeek` | categorical unordered | Day of Week when the crime happened |
| 4 | `Date` | Datetime | Date |
| 5 | `Time` | Datetime | Time|
| 6 | `PdDistrict` | categorical unorded |  District |
| 7 | `Resolution` | categorical unorded |  Kind of Punishment given to the criminal to resolve the case |
| 8 | `Address` | Geolocation | Address where the crime scene happened |
| 9 | `X` | Geolocation | Latitude of the crime Location |
| 10 | `Y` | Geolocation | Longitude of the Crime Location |
| 11 | `Location` | Geolocation | Exact Location Name |
| 12 | `PdId` | other | Pd Id|

Let's tidy the data:
* First, we ignore the last attribute pd Id because it is not so useful to take analysis
* Second We deal with the date here, as you could see, the time part in Date attribute is always 12:00:00 Am, so we would like to take it off and attach with the Time attribute and make Date attribute a datatype of datetime

```{r tidy}
tidy <- data %>%
  mutate(Time = hm(Time))%>%
  mutate(hour = hour(Time)) %>%
  mutate(Date = mdy_hms(Date)) %>%
  mutate(Month = format(Date, "%m")) %>%
  select(-PdId)

head(tidy, 10)

```

#### evaluation on single attributes

* First, let's look at the distribution of the number of crimes in year of 2016, the difference among all months are not pretty big

```{r eval1}

table(tidy$Month)

```

we use bar graph to give a visualization of the connection of how number of crimes differes from months. By the graph below, we could see much height difference among each bars, but Feburary and October look

```{r eval2}

tidy %>%
  group_by(Month)%>%
  summarize(num_incident = n()) %>%
  ggplot(mapping = aes(x = Month, y = num_incident)) + geom_bar(stat = "identity")

```

* Second, let's look the crime distribution in time(by hours): 

```{r eval3}
table(tidy$hour)

```

we could also use a bar graph to see the crime distribution of all crimes in hours. As you could see from the plot and table above, in year of 2016, the least crimes commited in time period of 05:00 - 05:59 and the most crimes commited in time period of  18:00 - 18:59. Baseing on boxplot, we could see that the peroid of 1:00 - 11:59 AM is the period that crime commited under the average value. Therefore, Police officer can have more security check ands shifts around city  in time period of 12:00 - 00:59.

```{r eval4}
tidy %>%
  group_by(hour) %>% 
    summarize(num_incident = n()) %>% 
  ggplot(mapping = (aes(x= factor(hour), y = num_incident))) + 
  geom_bar(stat = "identity")

```

* Distribution of crimes in a week: let's look at how crimes are distributed within a week in a year of 2016. 

```{r eval7}

sort(table(tidy$DayOfWeek))


```

From the table, there is not much difference between the distribution in each day of week, and the top three days that crimes mostly commited are Friday, Saturday and Thrusday. We use bar graph to visualize the data.

```{r eval8}

tidy %>%
  group_by(DayOfWeek) %>% 
    summarize(num_incident = n()) %>% 
  ggplot(mapping = (aes(x = DayOfWeek, y = num_incident))) + 
  geom_boxplot() + 
  geom_bar(stat = "identity")


```


```{r eval5}

sort(table(tidy$Category))


```

By looking at the table of categories, the top three crimes commited in San Franciso are LARCENY/THEFT, OTHER OFFENSES and NON-CRIMINAL. A good way to do visualize is to build up a pie chart, then we could see the proportion and differences among all categories. As you could see the largest proportion LARCENY/THEFT is more than a quarter.

```{r eval6}

tidy %>%
  group_by(Category) %>%
  summarize(num_incident = n()) %>% 
  ggplot(aes(x="", y=num_incident, fill=Category)) +
  geom_bar(stat="identity", width=1) +
  coord_polar("y", start=0)

```

## Exploratory Data Analysis

```{r data_analysis, include=TRUE, eval=TRUE}
map <- leaflet(data) %>%
  addTiles() %>%
  setView(lat=37.773972, lng=-122.431297, zoom=11)
map

```



### hypothesis testing and machine learning to provide analysis; 

```{r reg}
tidy_new <- tidy %>% 
  mutate(reso = ifelse(Resolution == "NONE", 0, 1))

tidy_new %>%
  group_by(DayOfWeek) %>% 
    summarize(week_num = n()) 
    
  
tidy_new <- inner_join(tidy_new, tidy, by = "DayOfWeek")
  
  
      

```


```{r reg2}

auto_fit <- lm(reso~hour, tidy_new)
auto_fit_stats <- auto_fit %>%
  tidy() 
auto_fit_stats %>% knitr::kable()

```

```{r check}
auto_fit %>% 
  augment() %>%
  ggplot(aes(x=.fitted, y=.resid)) +
    geom_point()


```




### and then the curation of a message or messages covering insights learned during the tutorial.
```{r data prep3}


```